<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Registry Constructor — makeRegistry • batchtools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Registry Constructor — makeRegistry" />
<meta property="og:description" content="makeRegistry constructs the inter-communication object for all functions in batchtools.
All communication transactions are processed via the file system:
All information required to run a job is stored as JobCollection in a file in the
a subdirectory of the file.dir directory.
Each jobs stores its results as well as computational status information (start time, end time, error message, ...)
also on the file system which is regular merged parsed by the master using syncRegistry.
After integrating the new information into the Registry, the Registry is serialized to the file system via saveRegistry.
Both syncRegistry and saveRegistry are called whenever required internally.
Therefore it should be safe to quit the R session at any time.
Work can later be resumed by calling loadRegistry which de-serializes the registry from
the file system.
The registry created last is saved in the package namespace (unless make.default is set to
FALSE) and can be retrieved via getDefaultRegistry.
Canceled jobs and jobs submitted multiple times may leave stray files behind.
These can be swept using sweepRegistry.
clearRegistry completely erases all jobs from a registry, including log files and results,
and thus allows you to start over." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">batchtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.14</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/batchtools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mllg/batchtools/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Registry Constructor</h1>
    <small class="dont-index">Source: <a href='https://github.com/mllg/batchtools/blob/master/R/Registry.R'><code>R/Registry.R</code></a></small>
    <div class="hidden name"><code>makeRegistry.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>makeRegistry</code> constructs the inter-communication object for all functions in <code>batchtools</code>.
All communication transactions are processed via the file system:
All information required to run a job is stored as <code><a href='makeJobCollection.html'>JobCollection</a></code> in a file in the
a subdirectory of the <code>file.dir</code> directory.
Each jobs stores its results as well as computational status information (start time, end time, error message, ...)
also on the file system which is regular merged parsed by the master using <code><a href='syncRegistry.html'>syncRegistry</a></code>.
After integrating the new information into the Registry, the Registry is serialized to the file system via <code><a href='saveRegistry.html'>saveRegistry</a></code>.
Both <code><a href='syncRegistry.html'>syncRegistry</a></code> and <code><a href='saveRegistry.html'>saveRegistry</a></code> are called whenever required internally.
Therefore it should be safe to quit the R session at any time.
Work can later be resumed by calling <code><a href='loadRegistry.html'>loadRegistry</a></code> which de-serializes the registry from
the file system.</p>
<p>The registry created last is saved in the package namespace (unless <code>make.default</code> is set to
<code>FALSE</code>) and can be retrieved via <code><a href='getDefaultRegistry.html'>getDefaultRegistry</a></code>.</p>
<p>Canceled jobs and jobs submitted multiple times may leave stray files behind.
These can be swept using <code><a href='sweepRegistry.html'>sweepRegistry</a></code>.
<code><a href='clearRegistry.html'>clearRegistry</a></code> completely erases all jobs from a registry, including log files and results,
and thus allows you to start over.</p>
    </div>

    <pre class="usage"><span class='fu'>makeRegistry</span><span class='op'>(</span>
  file.dir <span class='op'>=</span> <span class='st'>"registry"</span>,
  work.dir <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/getwd.html'>getwd</a></span><span class='op'>(</span><span class='op'>)</span>,
  conf.file <span class='op'>=</span> <span class='fu'><a href='findConfFile.html'>findConfFile</a></span><span class='op'>(</span><span class='op'>)</span>,
  packages <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>character</a></span><span class='op'>(</span><span class='fl'>0L</span><span class='op'>)</span>,
  namespaces <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>character</a></span><span class='op'>(</span><span class='fl'>0L</span><span class='op'>)</span>,
  source <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>character</a></span><span class='op'>(</span><span class='fl'>0L</span><span class='op'>)</span>,
  load <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>character</a></span><span class='op'>(</span><span class='fl'>0L</span><span class='op'>)</span>,
  seed <span class='op'>=</span> <span class='cn'>NULL</span>,
  make.default <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>file.dir</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
  Path where all files of the registry are saved.
  Default is directory &#8220;registry&#8221; in the current working directory.
  The provided path will get normalized unless it is given relative to the home directory
  (i.e., starting with &#8220;~&#8221;). Note that some templates do not handle relative paths well.</p>
<p>If you pass <code>NA</code>, a temporary directory will be used.
  This way, you can create disposable registries for <code><a href='btlapply.html'>btlapply</a></code> or examples.
  By default, the temporary directory <code><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a>()</code> will be used.
  If you want to use another directory, e.g. a directory which is shared between nodes,
  you can set it in your configuration file by setting the variable <code>temp.dir</code>.</p></td>
    </tr>
    <tr>
      <th>work.dir</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
  Working directory for R process for running jobs.
  Defaults to the working directory currently set during Registry construction (see <code><a href='https://rdrr.io/r/base/getwd.html'>getwd</a></code>).
  <code>loadRegistry</code> uses the stored <code>work.dir</code>, but you may also explicitly overwrite it,
  e.g., after switching to another system.</p>
<p>The provided path will get normalized unless it is given relative to the home directory
  (i.e., starting with &#8220;~&#8221;). Note that some templates do not handle relative paths well.</p></td>
    </tr>
    <tr>
      <th>conf.file</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
  Path to a configuration file which is sourced while the registry is created.
  In the configuration file you can define how <span class="pkg">batchtools</span> interacts with the system via <code><a href='makeClusterFunctions.html'>ClusterFunctions</a></code>.
  Separating the configuration of the underlying host system from the R code allows to easily move computation to another site.</p>
<p>The file lookup is implemented in the internal (but exported) function <code>findConfFile</code> which returns the first file found of the following candidates:</p><ol>
<li><p>File &#8220;batchtools.conf.R&#8221; in the path specified by the environment variable &#8220;R_BATCHTOOLS_SEARCH_PATH&#8221;.</p></li>
<li><p>File &#8220;batchtools.conf.R&#8221; in the current working directory.</p></li>
<li><p>File &#8220;config.R&#8221; in the user configuration directory as reported by <code><a href='https://rdrr.io/pkg/rappdirs/man/user_data_dir.html'>rappdirs::user_config_dir("batchtools", expand = FALSE)</a></code> (depending on OS, e.g., on linux this usually resolves to &#8220;~/.config/batchtools/config.R&#8221;).</p></li>
<li><p>&#8220;.batchtools.conf.R&#8221; in the home directory (&#8220;~&#8221;).</p></li>
<li><p>&#8220;config.R&#8221; in the site config directory as reported by <code><a href='https://rdrr.io/pkg/rappdirs/man/site_data_dir.html'>rappdirs::site_config_dir("batchtools")</a></code> (depending on OS). This file can be used for admins to set sane defaults for a computation site.</p></li>
</ol><p>Set to <code>NA</code> if you want to suppress reading any configuration file.
  If a configuration file is found, it gets sourced inside the environment of the registry after the defaults for all variables are set.
  Therefore you can set and overwrite slots, e.g. <code>default.resources = list(walltime = 3600)</code> to set default resources or &#8220;max.concurrent.jobs&#8221; to
  limit the number of jobs allowed to run simultaneously on the system.</p></td>
    </tr>
    <tr>
      <th>packages</th>
      <td><p>[<code>character</code>]<br />
Packages that will always be loaded on each node.
Uses <code><a href='https://rdrr.io/r/base/library.html'>require</a></code> internally.
Default is <code><a href='https://rdrr.io/r/base/character.html'>character(0)</a></code>.</p></td>
    </tr>
    <tr>
      <th>namespaces</th>
      <td><p>[<code>character</code>]<br />
Same as <code>packages</code>, but the packages will not be attached.
Uses <code><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></code> internally.
Default is <code><a href='https://rdrr.io/r/base/character.html'>character(0)</a></code>.</p></td>
    </tr>
    <tr>
      <th>source</th>
      <td><p>[<code>character</code>]<br />
Files which should be sourced on the slaves prior to executing a job.
Calls <code><a href='https://rdrr.io/r/base/sys.source.html'>sys.source</a></code> using the <code><a href='https://rdrr.io/r/base/environment.html'>.GlobalEnv</a></code>.</p></td>
    </tr>
    <tr>
      <th>load</th>
      <td><p>[<code>character</code>]<br />
Files which should be loaded on the slaves prior to executing a job.
Calls <code><a href='https://rdrr.io/r/base/load.html'>load</a></code> using the <code><a href='https://rdrr.io/r/base/environment.html'>.GlobalEnv</a></code>.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/integer.html'>integer(1)</a></code>]<br />
Start seed for jobs. Each job uses the (<code>seed</code> + <code>job.id</code>) as seed.
Default is a random integer between 1 and 32768</p></td>
    </tr>
    <tr>
      <th>make.default</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code>]<br />
If set to <code>TRUE</code>, the created registry is saved inside the package
namespace and acts as default registry. You might want to switch this
off if you work with multiple registries simultaneously.
Default is <code>TRUE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>[<code>environment</code>] of class &#8220;Registry&#8221; with the following slots:</p><dl>
    <dt><code>file.dir</code> [path]:</dt><dd><p>File directory.</p></dd>
    <dt><code>work.dir</code> [path]:</dt><dd><p>Working directory.</p></dd>
    <dt><code>temp.dir</code> [path]:</dt><dd><p>Temporary directory. Used if <code>file.dir</code> is <code>NA</code> to create temporary registries.</p></dd>
    <dt><code>packages</code> [character()]:</dt><dd><p>Packages to load on the slaves.</p></dd>
    <dt><code>namespaces</code> [character()]:</dt><dd><p>Namespaces to load on the slaves.</p></dd>
    <dt><code>seed</code> [integer(1)]:</dt><dd><p>Registry seed. Before each job is executed, the seed <code>seed + job.id</code> is set.</p></dd>
    <dt><code>cluster.functions</code> [cluster.functions]:</dt><dd><p>Usually set in your <code>conf.file</code>. Set via a call to <code><a href='makeClusterFunctions.html'>makeClusterFunctions</a></code>. See example.</p></dd>
    <dt><code>default.resources</code> [named list()]:</dt><dd><p>Usually set in your <code>conf.file</code>. Named list of default resources.</p></dd>
    <dt><code>max.concurrent.jobs</code> [integer(1)]:</dt><dd><p>Usually set in your <code>conf.file</code>. Maximum number of concurrent jobs for a single user and current registry on the system.
      <code><a href='submitJobs.html'>submitJobs</a></code> will try to respect this setting. The resource &#8220;max.concurrent.jobs&#8221; has higher precedence.</p></dd>
    <dt><code>defs</code> [data.table]:</dt><dd><p>Table with job definitions (i.e. parameters).</p></dd>
    <dt><code>status</code> [data.table]:</dt><dd><p>Table holding information about the computational status. Also see <code><a href='getJobTable.html'>getJobStatus</a></code>.</p></dd>
    <dt><code>resources</code> [data.table]:</dt><dd><p>Table holding information about the computational resources used for the job. Also see <code><a href='getJobTable.html'>getJobResources</a></code>.</p></dd>
    <dt><code>tags</code> [data.table]:</dt><dd><p>Table holding information about tags. See <a href='Tags.html'>Tags</a>.</p></dd>
    <dt><code>hash</code> [character(1)]:</dt><dd><p>Unique hash which changes each time the registry gets saved to the file system. Can be utilized to invalidate the cache of <span class="pkg">knitr</span>.</p></dd>
  
</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Currently <span class="pkg">batchtools</span> understands the following options set via the configuration file:</p><dl>
  <dt><code>cluster.functions</code>:</dt><dd><p>As returned by a constructor, e.g. <code><a href='makeClusterFunctionsSlurm.html'>makeClusterFunctionsSlurm</a></code>.</p></dd>
  <dt><code>default.resources</code>:</dt><dd><p>List of resources to use. Will be overruled by resources specified via <code><a href='submitJobs.html'>submitJobs</a></code>.</p></dd>
  <dt><code>temp.dir</code>:</dt><dd><p>Path to directory to use for temporary registries.</p></dd>
  <dt><code>sleep</code>:</dt><dd><p>Custom sleep function. See <code><a href='waitForJobs.html'>waitForJobs</a></code>.</p></dd>
  <dt><code>expire.after</code>:</dt><dd><p>Number of iterations before treating jobs as expired in <code><a href='waitForJobs.html'>waitForJobs</a></code>.</p></dd>
  <dt><code>compress</code>:</dt><dd><p>Compression algorithm to use via <code><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></code>.</p></dd>

</dl>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other Registry: 
<code><a href='clearRegistry.html'>clearRegistry</a>()</code>,
<code><a href='getDefaultRegistry.html'>getDefaultRegistry</a>()</code>,
<code><a href='loadRegistry.html'>loadRegistry</a>()</code>,
<code><a href='removeRegistry.html'>removeRegistry</a>()</code>,
<code><a href='saveRegistry.html'>saveRegistry</a>()</code>,
<code><a href='sweepRegistry.html'>sweepRegistry</a>()</code>,
<code><a href='syncRegistry.html'>syncRegistry</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'> <span class='fu'>batchtools</span><span class='fu'>:::</span><span class='fu'>example_push_temp</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> 
<span class='va'>tmp</span> <span class='op'>=</span> <span class='fu'>makeRegistry</span><span class='op'>(</span>file.dir <span class='op'>=</span> <span class='cn'>NA</span>, make.default <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>No readable configuration file found</span></div><div class='output co'>#&gt; <span class='message'>Created registry in '/tmp/batchtools-example/reg' using cluster functions 'Interactive'</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>tmp</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Job Registry
#&gt;   Backend  : Interactive
#&gt;   File dir : /tmp/batchtools-example/reg
#&gt;   Work dir : /home/michel/Projekte/batchtools/docs/reference
#&gt;   Jobs     : 0
#&gt;   Seed     : 5075
#&gt;   Writeable: TRUE</div><div class='input'>
<span class='co'># Set cluster functions to interactive mode and start jobs in external R sessions</span>
<span class='va'>tmp</span><span class='op'>$</span><span class='va'>cluster.functions</span> <span class='op'>=</span> <span class='fu'><a href='makeClusterFunctionsInteractive.html'>makeClusterFunctionsInteractive</a></span><span class='op'>(</span>external <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># Change packages to load</span>
<span class='va'>tmp</span><span class='op'>$</span><span class='va'>packages</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MASS"</span><span class='op'>)</span>
<span class='fu'><a href='saveRegistry.html'>saveRegistry</a></span><span class='op'>(</span>reg <span class='op'>=</span> <span class='va'>tmp</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Michel Lang, Bernd Bischl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


