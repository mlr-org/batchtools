<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Submit Jobs to the Batch Systems — submitJobs • batchtools</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Submit Jobs to the Batch Systems — submitJobs"><meta name="description" content="Submits defined jobs to the batch system.
After submitting the jobs, you can use waitForJobs to wait for the
termination of jobs or call reduceResultsList/reduceResults
to collect partial results.
The progress can be monitored with getStatus."><meta property="og:description" content="Submits defined jobs to the batch system.
After submitting the jobs, you can use waitForJobs to wait for the
termination of jobs or call reduceResultsList/reduceResults
to collect partial results.
The progress can be monitored with getStatus."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">batchtools</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.9.17-9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-alt"></span> Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr3book.mlr-org.com"><span class="fa fa-link"></span> mlr3book</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/batchtools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/"><span class="fa fa-comments"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://stackoverflow.com/questions/tagged/mlr3"><span class="fa fab fa-stack-overflow"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr-org.com/"><span class="fa fa-rss"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Submit Jobs to the Batch Systems</h1>
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/batchtools/blob/main/R/submitJobs.R" class="external-link"><code>R/submitJobs.R</code></a></small>
      <div class="d-none name"><code>submitJobs.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Submits defined jobs to the batch system.</p>
<p>After submitting the jobs, you can use <code><a href="waitForJobs.html">waitForJobs</a></code> to wait for the
termination of jobs or call <code><a href="reduceResultsList.html">reduceResultsList</a></code>/<code><a href="reduceResults.html">reduceResults</a></code>
to collect partial results.
The progress can be monitored with <code><a href="getStatus.html">getStatus</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">submitJobs</span><span class="op">(</span></span>
<span>  ids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  resources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  sleep <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  reg <span class="op">=</span> <span class="fu"><a href="getDefaultRegistry.html">getDefaultRegistry</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-ids">ids<a class="anchor" aria-label="anchor" href="#arg-ids"></a></dt>
<dd><p>[<code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> or <code>integer</code>]<br>
A <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> (or <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code>)
with a column named “job.id”.
Alternatively, you may also pass a vector of integerish job ids.
If not set, defaults to the return value of <code><a href="findJobs.html">findNotSubmitted</a></code>.
Invalid ids are ignored.</p></dd>


<dt id="arg-resources">resources<a class="anchor" aria-label="anchor" href="#arg-resources"></a></dt>
<dd><p>[<code>named list</code>]<br>
Computational  resources for the jobs to submit. The actual elements of this list
(e.g. something like “walltime” or “nodes”) depend on your template file, exceptions are outlined in the section 'Resources'.
Default settings for a system can be set in the configuration file by defining the named list <code>default.resources</code>.
Note that these settings are merged by name, e.g. merging <code>list(walltime = 300)</code> into <code>list(walltime = 400, memory = 512)</code>
will result in <code>list(walltime = 300, memory = 512)</code>.
Same holds for individual job resources passed as additional column of <code>ids</code> (c.f. section 'Resources').</p></dd>


<dt id="arg-sleep">sleep<a class="anchor" aria-label="anchor" href="#arg-sleep"></a></dt>
<dd><p>[<code>function(i)</code> | <code>numeric(1)</code>]<br>
Parameter to control the duration to sleep between temporary errors.
You can pass an absolute numeric value in seconds or a <code>function(i)</code> which returns the number of seconds to sleep in the <code>i</code>-th
iteration between temporary errors.
If not provided (<code>NULL</code>), tries to read the value (number/function) from the configuration file (stored in <code>reg$sleep</code>) or defaults to
a function with exponential backoff between 5 and 120 seconds.</p></dd>


<dt id="arg-reg">reg<a class="anchor" aria-label="anchor" href="#arg-reg"></a></dt>
<dd><p>[<code><a href="makeRegistry.html">Registry</a></code>]<br>
Registry. If not explicitly passed, uses the default registry (see <code><a href="getDefaultRegistry.html">setDefaultRegistry</a></code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>[<code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code>] with columns “job.id” and “chunk”.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>If you a large number of jobs, disabling the progress bar (<code>options(batchtools.progress = FALSE)</code>)
can significantly increase the performance of <code>submitJobs</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a></h2>


<p>You can pass arbitrary resources to <code>submitJobs()</code> which then are available in the cluster function template.
Some resources' names are standardized and it is good practice to stick to the following nomenclature to avoid confusion:</p><dl><dt>walltime:</dt>
<dd><p>Upper time limit in seconds for jobs before they get killed by the scheduler. Can be passed as additional column as part of <code>ids</code> to set per-job resources.</p></dd>

 <dt>memory:</dt>
<dd><p>Memory limit in Mb. If jobs exceed this limit, they are usually killed by the scheduler. Can be passed as additional column as part of <code>ids</code> to set per-job resources.</p></dd>

 <dt>ncpus:</dt>
<dd><p>Number of (physical) CPUs to use on the slave. Can be passed as additional column as part of <code>ids</code> to set per-job resources.</p></dd>

 <dt>omp.threads:</dt>
<dd><p>Number of threads to use via OpenMP. Used to set environment variable “OMP_NUM_THREADS”. Can be passed as additional column as part of <code>ids</code> to set per-job resources.</p></dd>

 <dt>pp.size:</dt>
<dd><p>Maximum size of the pointer protection stack, see <code><a href="https://rdrr.io/r/base/Memory.html" class="external-link">Memory</a></code>.</p></dd>

 <dt>blas.threads:</dt>
<dd><p>Number of threads to use for the BLAS backend. Used to set environment variables “MKL_NUM_THREADS” and “OPENBLAS_NUM_THREADS”. Can be passed as additional column as part of <code>ids</code> to set per-job resources.</p></dd>

 <dt>measure.memory:</dt>
<dd><p>Enable memory measurement for jobs. Comes with a small runtime overhead.</p></dd>

 <dt>chunks.as.arrayjobs:</dt>
<dd><p>Execute chunks as array jobs.</p></dd>

 <dt>pm.backend:</dt>
<dd><p>Start a <span class="pkg">parallelMap</span> backend on the slave.</p></dd>

 <dt>foreach.backend:</dt>
<dd><p>Start a <span class="pkg">foreach</span> backend on the slave.</p></dd>

 <dt>clusters:</dt>
<dd><p>Resource used for Slurm to select the set of clusters to run <code>sbatch</code>/<code>squeue</code>/<code>scancel</code> on.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="chunking-of-jobs">Chunking of Jobs<a class="anchor" aria-label="anchor" href="#chunking-of-jobs"></a></h2>


<p>Multiple jobs can be grouped (chunked) together to be executed sequentially on the batch system as a single batch job.
This is especially useful to avoid overburding the scheduler by submitting thousands of jobs simultaneously.
To chunk jobs together, job ids must be provided as <code>data.frame</code> with columns “job.id” and “chunk” (integer).
All jobs with the same chunk number will be executed sequentially inside the same batch job.
The utility functions <code><a href="chunk.html">chunk</a></code>, <code><a href="chunk.html">binpack</a></code> and <code><a href="chunk.html">lpt</a></code>
can assist in grouping jobs.</p>
    </div>
    <div class="section level2">
    <h2 id="array-jobs">Array Jobs<a class="anchor" aria-label="anchor" href="#array-jobs"></a></h2>


<p>If your cluster supports array jobs, you can set the resource <code>chunks.as.arrayjobs</code> to <code>TRUE</code> in order
to execute chunks as job arrays on the cluster.
For each chunk of size <code>n</code>, <span class="pkg">batchtools</span> creates a <code><a href="JobCollection.html">JobCollection</a></code> of (possibly heterogeneous) jobs which is
submitted to the scheduler as a single array job with <code>n</code> repetitions.
For each repetition, the <code>JobCollection</code> is first read from the file system, then subsetted to the <code>i</code>-th job using
the environment variable <code>reg$cluster.functions$array.var</code> (depending on the cluster backend, defined automatically) and finally
executed.</p>
    </div>
    <div class="section level2">
    <h2 id="order-of-submission">Order of Submission<a class="anchor" aria-label="anchor" href="#order-of-submission"></a></h2>


<p>Jobs are submitted in the order of chunks, i.e. jobs which have chunk number
<code>sort(unique(ids$chunk))[1]</code> first, then jobs with chunk number <code>sort(unique(ids$chunk))[2]</code>
and so on. If no chunks are provided, jobs are submitted in the order of <code>ids$job.id</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="limiting-the-number-of-jobs">Limiting the Number of Jobs<a class="anchor" aria-label="anchor" href="#limiting-the-number-of-jobs"></a></h2>


<p>If requested, <code>submitJobs</code> tries to limit the number of concurrent jobs of the user by waiting until jobs terminate
before submitting new ones.
This can be controlled by setting “max.concurrent.jobs” in the configuration file (see <code><a href="makeRegistry.html">Registry</a></code>)
or by setting the resource “max.concurrent.jobs” to the maximum number of jobs to run simultaneously.
If both are set, the setting via the resource takes precedence over the setting in the configuration.</p>
    </div>
    <div class="section level2">
    <h2 id="measuring-memory">Measuring Memory<a class="anchor" aria-label="anchor" href="#measuring-memory"></a></h2>


<p>Setting the resource <code>measure.memory</code> to <code>TRUE</code> turns on memory measurement:
<code><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></code> is called  directly before and after the job and the difference is
stored in the internal database. Note that this is just a rough estimate and does
neither work reliably for external code like C/C++ nor in combination with threading.</p>
    </div>
    <div class="section level2">
    <h2 id="inner-parallelization">Inner Parallelization<a class="anchor" aria-label="anchor" href="#inner-parallelization"></a></h2>


<p>Inner parallelization is typically done via threading, sockets or MPI.
Two backends are supported to assist in setting up inner parallelization.</p>
<p>The first package is <span class="pkg">parallelMap</span>.
If you set the resource “pm.backend” to “multicore”, “socket” or “mpi”,
<code><a href="https://parallelmap.mlr-org.com/reference/parallelStart.html" class="external-link">parallelStart</a></code> is called on the slave before the first job in the chunk is started
and <code><a href="https://parallelmap.mlr-org.com/reference/parallelStop.html" class="external-link">parallelStop</a></code> is called after the last job terminated.
This way, the resources for inner parallelization can be set and get automatically stored just like other computational resources.
The function provided by the user just has to call <code><a href="https://parallelmap.mlr-org.com/reference/parallelMap.html" class="external-link">parallelMap</a></code> to start parallelization using the preconfigured backend.</p>
<p>To control the number of CPUs, you have to set the resource <code>ncpus</code>.
Otherwise <code>ncpus</code> defaults to the number of available CPUs (as reported by (see <code><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></code>))
on the executing machine for multicore and socket mode and defaults to the return value of <code><a href="https://rdrr.io/pkg/Rmpi/man/mpi.universe.size.html" class="external-link">mpi.universe.size</a>-1</code> for MPI.
Your template must be set up to handle the parallelization, e.g. request the right number of CPUs or start R with <code>mpirun</code>.
You may pass further options like <code>level</code> to <code><a href="https://parallelmap.mlr-org.com/reference/parallelStart.html" class="external-link">parallelStart</a></code> via the named list “pm.opts”.</p>
<p>The second supported parallelization backend is <span class="pkg">foreach</span>.
If you set the resource “foreach.backend” to “seq” (sequential mode), “parallel” (<span class="pkg">doParallel</span>) or
“mpi” (<span class="pkg">doMPI</span>), the requested <span class="pkg">foreach</span> backend is automatically registered on the slave.
Again, the resource <code>ncpus</code> is used to determine the number of CPUs.</p>
<p>Neither the namespace of <span class="pkg">parallelMap</span> nor the namespace <span class="pkg">foreach</span> are attached.
You have to do this manually via <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></code> or let the registry load the packages for you.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">### Example 1: Submit subsets of jobs</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">=</span> <span class="fu"><a href="makeRegistry.html">makeRegistry</a></span><span class="op">(</span>file.dir <span class="op">=</span> <span class="cn">NA</span>, make.default <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No readable configuration file found</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created registry in '/tmp/batchtools-example/reg1' using cluster functions 'Interactive'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># toy function which fails if x is even and an input file does not exists</span></span></span>
<span class="r-in"><span><span class="va">fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">fn</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">fn</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"file not found"</span><span class="op">)</span> <span class="kw">else</span> <span class="va">x</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define jobs via batchMap</span></span></span>
<span class="r-in"><span><span class="va">fn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ids</span> <span class="op">=</span> <span class="fu"><a href="batchMap.html">batchMap</a></span><span class="op">(</span><span class="va">fun</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, reg <span class="op">=</span> <span class="va">tmp</span>, fn <span class="op">=</span> <span class="va">fn</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding 20 jobs ...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># submit some jobs</span></span></span>
<span class="r-in"><span><span class="va">ids</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span></span>
<span class="r-in"><span><span class="fu">submitJobs</span><span class="op">(</span><span class="va">ids</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Submitting 10 jobs in 10 chunks using cluster functions 'Interactive' ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in (function (x, fn)  : file not found</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in (function (x, fn)  : file not found</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in (function (x, fn)  : file not found</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in (function (x, fn)  : file not found</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in (function (x, fn)  : file not found</span>
<span class="r-in"><span><span class="fu"><a href="waitForJobs.html">waitForJobs</a></span><span class="op">(</span><span class="va">ids</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"><span><span class="fu"><a href="getStatus.html">getStatus</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Status for 20 jobs at 2025-05-22 14:40:05:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Submitted    : 10 ( 50.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Queued    :  0 (  0.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Started   : 10 ( 50.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Running :  0 (  0.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Done    :  5 ( 25.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Error   :  5 ( 25.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Expired :  0 (  0.0%)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create the required file and re-submit failed jobs</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.create</a></span><span class="op">(</span><span class="va">fn</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu">submitJobs</span><span class="op">(</span><span class="fu"><a href="findJobs.html">findErrors</a></span><span class="op">(</span><span class="va">ids</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Submitting 5 jobs in 5 chunks using cluster functions 'Interactive' ...</span>
<span class="r-in"><span><span class="fu"><a href="getStatus.html">getStatus</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Status for 20 jobs at 2025-05-22 14:40:05:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Submitted    : 10 ( 50.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Queued    :  0 (  0.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Started   : 10 ( 50.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Running :  0 (  0.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Done    : 10 ( 50.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Error   :  0 (  0.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Expired :  0 (  0.0%)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># submit remaining jobs which have not yet been submitted</span></span></span>
<span class="r-in"><span><span class="va">ids</span> <span class="op">=</span> <span class="fu"><a href="findJobs.html">findNotSubmitted</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">submitJobs</span><span class="op">(</span><span class="va">ids</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Submitting 10 jobs in 10 chunks using cluster functions 'Interactive' ...</span>
<span class="r-in"><span><span class="fu"><a href="getStatus.html">getStatus</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Status for 20 jobs at 2025-05-22 14:40:06:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Submitted    : 20 (100.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Queued    :  0 (  0.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Started   : 20 (100.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Running :  0 (  0.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Done    : 20 (100.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Error   :  0 (  0.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---- Expired :  0 (  0.0%)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># collect results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="reduceResultsList.html">reduceResultsList</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[4]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[5]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[6]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[7]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[8]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[9]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[10]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[11]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[12]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[13]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[14]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[15]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[16]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[17]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[18]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[19]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[20]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Example 2: Using memory measurement</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">=</span> <span class="fu"><a href="makeRegistry.html">makeRegistry</a></span><span class="op">(</span>file.dir <span class="op">=</span> <span class="cn">NA</span>, make.default <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No readable configuration file found</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created registry in '/tmp/batchtools-example/reg2' using cluster functions 'Interactive'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Toy function which creates a large matrix and returns the column sums</span></span></span>
<span class="r-in"><span><span class="va">fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">p</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Arguments to fun:</span></span></span>
<span class="r-in"><span><span class="va">args</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/J.html" class="external-link">CJ</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e4</span>, <span class="fl">1e5</span><span class="op">)</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="co"># like expand.grid()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Key: &lt;n, p&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        n     p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;num&gt; &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: 1e+04    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: 1e+04    50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3: 1e+05    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4: 1e+05    50</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Map function to create jobs</span></span></span>
<span class="r-in"><span><span class="va">ids</span> <span class="op">=</span> <span class="fu"><a href="batchMap.html">batchMap</a></span><span class="op">(</span><span class="va">fun</span>, args <span class="op">=</span> <span class="va">args</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding 4 jobs ...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set resources: enable memory measurement</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>measure.memory <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Submit jobs using the currently configured cluster functions</span></span></span>
<span class="r-in"><span><span class="fu">submitJobs</span><span class="op">(</span><span class="va">ids</span>, resources <span class="op">=</span> <span class="va">res</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Submitting 4 jobs in 4 chunks using cluster functions 'Interactive' ...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Retrive information about memory, combine with parameters</span></span></span>
<span class="r-in"><span><span class="va">info</span> <span class="op">=</span> <span class="fu"><a href="JoinTables.html">ijoin</a></span><span class="op">(</span><span class="fu"><a href="getJobTable.html">getJobStatus</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">job.id</span>, <span class="va">mem.used</span><span class="op">)</span><span class="op">]</span>, <span class="fu"><a href="getJobTable.html">getJobPars</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="unwrap.html">unwrap</a></span><span class="op">(</span><span class="va">info</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Key: &lt;job.id&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    job.id mem.used     n     p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;int&gt;    &lt;num&gt; &lt;num&gt; &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:      1 163.0077 1e+04    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:      2 163.0085 1e+04    50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:      3 163.0084 1e+05    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:      4 163.0087 1e+05    50</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combine job info with results -&gt; each job is aggregated using mean()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="unwrap.html">unwrap</a></span><span class="op">(</span><span class="fu"><a href="JoinTables.html">ijoin</a></span><span class="op">(</span><span class="va">info</span>, <span class="fu"><a href="reduceResultsList.html">reduceResultsDataTable</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Key: &lt;job.id&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    job.id mem.used     n     p       res</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;int&gt;    &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:      1 163.0077 1e+04    10 0.5005778</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:      2 163.0085 1e+04    50 0.4992527</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:      3 163.0084 1e+05    10 0.5000026</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:      4 163.0087 1e+05    50 0.4999301</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Example 3: Multicore execution on the slave</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">=</span> <span class="fu"><a href="makeRegistry.html">makeRegistry</a></span><span class="op">(</span>file.dir <span class="op">=</span> <span class="cn">NA</span>, make.default <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No readable configuration file found</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created registry in '/tmp/batchtools-example/reg3' using cluster functions 'Interactive'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Function which sleeps 10 seconds, i-times</span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">parallelMap</span><span class="fu">::</span><span class="fu"><a href="https://parallelmap.mlr-org.com/reference/parallelMap.html" class="external-link">parallelMap</a></span><span class="op">(</span><span class="va">Sys.sleep</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create one job with parameter i=4</span></span></span>
<span class="r-in"><span><span class="va">ids</span> <span class="op">=</span> <span class="fu"><a href="batchMap.html">batchMap</a></span><span class="op">(</span><span class="va">f</span>, i <span class="op">=</span> <span class="fl">4</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding 1 jobs ...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set resources: Use parallelMap in multicore mode with 4 CPUs</span></span></span>
<span class="r-in"><span><span class="co"># batchtools internally loads the namespace of parallelMap and then</span></span></span>
<span class="r-in"><span><span class="co"># calls parallelStart() before the job and parallelStop() right</span></span></span>
<span class="r-in"><span><span class="co"># after the job last job in the chunk terminated.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pm.backend <span class="op">=</span> <span class="st">"multicore"</span>, ncpus <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Submit both jobs and wait for them</span></span></span>
<span class="r-in"><span><span class="fu">submitJobs</span><span class="op">(</span>resources <span class="op">=</span> <span class="va">res</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="waitForJobs.html">waitForJobs</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If successfull, the running time should be ~10s</span></span></span>
<span class="r-in"><span><span class="fu"><a href="getJobTable.html">getJobTable</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">job.id</span>, <span class="va">time.running</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># There should also be a note in the log:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="grepLogs.html">grepLogs</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"parallelMap"</span>, reg <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michel Lang, Bernd Bischl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

